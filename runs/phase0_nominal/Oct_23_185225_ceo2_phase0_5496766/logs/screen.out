[1761263546.282637] [ccc0218:3112379:0]     ucp_context.c:2339 UCX  INFO  Version 1.19.0 (loaded from /lib64/libucp.so.0)
[1761263546.332126] [ccc0218:3112379:0]          parser.c:2368 UCX  INFO  UCX_* env variables: UCX_NET_DEVICES=mlx5_0:1 UCX_IB_GID_INDEX=3 UCX_IB_TRAFFIC_CLASS=104 UCX_TLS=rc,self,sm UCX_SOCKADDR_TLS_PRIORITY=rdmacm UCX_LOG_LEVEL=info
[1761263546.332757] [ccc0218:3112379:0]      ucp_worker.c:1903 UCX  INFO    ucp_context_0 self cfg#0 tag(self/memory rc_mlx5/mlx5_0:1 cma/memory)
LAMMPS (29 Aug 2024 - Update 1)
  using 1 OpenMP thread(s) per MPI task
# in.main.lmp — Phase 0 (debug-friendly, line-flushed)

echo            both
units           ${UNITS}
units           metal
atom_style      charge
boundary        ${BX} ${BY} ${BZ}
boundary        p ${BY} ${BZ}
boundary        p p ${BZ}
boundary        p p p

# --- structure & masses (defines the box) ---
read_data       ${DATAFILE}
read_data       inputs/structure/data.ceo2_4x4x8nm.lmp
Reading data file ...
  orthogonal box = (0 0 0) to (43.739603 43.739603 82.011755)
  1 by 1 by 1 MPI processor grid
  reading atoms ...
  11520 atoms
  read_data CPU = 0.054 seconds
mass            1 140.116
mass            2 15.999

# ensure per-run subdirs exist on the compute node
shell           mkdir -p ${OUTDIR}/logs
shell           mkdir -p /u/gclopton/scratch/lammps/runs/phase0_nominal/Oct_23_185225_ceo2_phase0_5496766/logs
shell           mkdir -p ${OUTDIR}/dumps
shell           mkdir -p /u/gclopton/scratch/lammps/runs/phase0_nominal/Oct_23_185225_ceo2_phase0_5496766/dumps
shell           mkdir -p ${OUTDIR}/post
shell           mkdir -p /u/gclopton/scratch/lammps/runs/phase0_nominal/Oct_23_185225_ceo2_phase0_5496766/post

# --- temperature compute (valid before any run) ---
compute         t_all all temp

# --- live thermo (AFTER box exists) ---
thermo          100
thermo_style    custom step time temp press pe ke evdwl ecoul etotal
thermo_modify   flush yes
thermo_modify   temp t_all

# --- scalars for writers ---
variable s   equal step
variable T   equal c_t_all
variable P   equal press
variable PE  equal pe
variable KE  equal ke
variable ET  equal etotal

# simple timeseries you can tail (written DURING runs)
variable THFILE string ${OUTDIR}/dumps/thermo.tsv
variable THFILE string /u/gclopton/scratch/lammps/runs/phase0_nominal/Oct_23_185225_ceo2_phase0_5496766/dumps/thermo.tsv
fix tsv all print 100 "${s} ${T} ${P} ${PE} ${KE} ${ET}" file ${THFILE} screen no title "step T(K) P(bar) PE(eV) KE(eV) ET(eV)"
fix tsv all print 100 "${s} ${T} ${P} ${PE} ${KE} ${ET}" file /u/gclopton/scratch/lammps/runs/phase0_nominal/Oct_23_185225_ceo2_phase0_5496766/dumps/thermo.tsv screen no title "step T(K) P(bar) PE(eV) KE(eV) ET(eV)"

# optional: if you want a single line at step 0, uncomment the next two
# run 0 post no
# print "${s} ${T} ${P} ${PE} ${KE} ${ET}" file ${THFILE} screen no append yes

# --- neighbor / timestep ---
neighbor        2.0 bin
neigh_modify    delay 0 every 1 check yes
timestep        ${DT}
timestep        0.0005

# --- electrostatics & short-range interactions ---
include         inputs/lammps/includes/kspace_pppm.in
kspace_style  pppm 1.0e-5
kspace_modify order 5
# Do NOT use slab correction for p p p:
# kspace_modify slab 3.0
include         inputs/lammps/includes/pair_ceo2_buck.in
variable rc_buck equal 12.0
pair_style   buck/coul/long ${rc_buck}
pair_style   buck/coul/long 12
pair_modify  mix arithmetic
# IMPORTANT: this params file must emit all three buck/coul/long pair_coeff lines:
#   pair_coeff 1 1 buck/coul/long A11 rho11 C11
#   pair_coeff 1 2 buck/coul/long A12 rho12 C12
#   pair_coeff 2 2 buck/coul/long A22 rho22 C22
include inputs/lammps/includes/params/ceo2_buck.params
# Buckingham coefficients for fluorite CeO2 (rigid-ion)
# Form: A [eV], rho [Å], C [eV·Å^6], cutoff [Å]
# Source: Sayle et al., Nanoscale 2011, 3, 1823–1837, Table 1. (O–O, Ce–O; Ce–Ce set to zero)

# O–O
pair_coeff 2 2  22764.30   0.149   27.89   ${rc_buck}
pair_coeff 2 2  22764.30   0.149   27.89   12

# Ce–O
pair_coeff 1 2   1986.83   0.351   20.40   ${rc_buck}
pair_coeff 1 2   1986.83   0.351   20.40   12

# Ce–Ce (short-range off; Coulomb only). LAMMPS requires a rho even when A=C=0.
pair_coeff 1 1      0.0     1.0      0.0   ${rc_buck}
pair_coeff 1 1      0.0     1.0      0.0   12
# include       inputs/lammps/includes/pair_zbl_overlay.in
include         inputs/lammps/includes/rim_langevin.in
# rim_langevin.in — robust x–y rim sponge (units metal)
# Expects: RIM_WIDTH_NM (nm), RIM_GAMMA (ps^-1), RIM_TK (K) via -var

# Local RNG seed (kept distinct to avoid collisions)
variable rim_seed equal 98765

# Convert rim width to Å
variable rim_wA   equal ${RIM_WIDTH_NM}*10.0
variable rim_wA   equal 1.5*10.0

# Capture box bounds into local variables (numbers)
variable bxlo     equal xlo
variable bxhi     equal xhi
variable bylo     equal ylo
variable byhi     equal yhi

# Precompute slab faces (avoid spaces in expressions)
variable bxlo_hi  equal v_bxlo+v_rim_wA
variable bxhi_lo  equal v_bxhi-v_rim_wA
variable bylo_hi  equal v_bylo+v_rim_wA
variable byhi_lo  equal v_byhi-v_rim_wA

# Four x/y edge slabs; thickness = rim_wA
region rim_xlo block v_bxlo    v_bxlo_hi  INF INF INF INF units box
region rim_xhi block v_bxhi_lo v_bxhi     INF INF INF INF units box
region rim_ylo block INF INF   v_bylo     v_bylo_hi  INF INF units box
region rim_yhi block INF INF   v_byhi_lo  v_byhi     INF INF units box

# Union them into a single region, then define the rim group from that region
region rim_union union 4 rim_xlo rim_xhi rim_ylo rim_yhi
group  rim region rim_union
10065 atoms in group rim

# Langevin thermostat on the rim only (interior integrates elsewhere)
fix f_rim rim langevin ${RIM_TK} ${RIM_TK} ${RIM_GAMMA} ${rim_seed} zero yes
fix f_rim rim langevin 300 ${RIM_TK} ${RIM_GAMMA} ${rim_seed} zero yes
fix f_rim rim langevin 300 300 ${RIM_GAMMA} ${rim_seed} zero yes
fix f_rim rim langevin 300 300 1 ${rim_seed} zero yes
fix f_rim rim langevin 300 300 1 98765 zero yes

# Optional sanity print
print "rim_langevin: bxlo=${bxlo} bxhi=${bxhi} bylo=${bylo} byhi=${byhi} rim_wA=${rim_wA}" screen yes
rim_langevin: bxlo=0 bxhi=43.7396027821217 bylo=0 byhi=43.7396027821217 rim_wA=15

# --- stages ---

variable neq equal 0
include         inputs/lammps/in.equil.lmp
print "=== Equilibration stage: brief NVT at 300 K ===" append yes
=== Equilibration stage: brief NVT at 300 K ===


# rim group  expected from rim_langevin.in
group interior subtract all rim
1455 atoms in group interior

# ---------- Velocity intialization
# Default seed if none passed in
variable VEL_SEED equal 13579

velocity interior create 300.0 ${VEL_SEED} mom yes rot yes dist gaussian
velocity interior create 300.0 13579 mom yes rot yes dist gaussian
# remove any residual COM drift every 100 steps during equil
fix fix_mom interior momentum 100 linear 1 1 1

# ---------- Nosé–Hoover thermostat on interior only
# Choose a gentle damping time--> 0.1 ps is conservative at DT ≈ 0.0005 ps
variable Tdamp equal 0.1
fix fix_nvt interior nvt temp 300.0 300.0 ${Tdamp}
fix fix_nvt interior nvt temp 300.0 300.0 0.1
fix_modify fix_nvt temp thermo_temp  # use the default thermo temperature compute

# ---------- Pick short equilibration length (≈10% of total, min 1000 steps) ----------
variable neq equal 100
print "Equilibration steps (neq) = ${neq} (Tdamp = ${Tdamp} ps)" append yes
Equilibration steps (neq) = 100 (Tdamp = 0.1 ps)

# ---------- Run equilibration -- ----
run ${neq}
run 100

CITE-CITE-CITE-CITE-CITE-CITE-CITE-CITE-CITE-CITE-CITE-CITE-CITE

Your simulation uses code contributions which should be cited:
- Type Label Framework: https://doi.org/10.1021/acs.jpcb.3c08419
The log file lists these citations in BibTeX format.

CITE-CITE-CITE-CITE-CITE-CITE-CITE-CITE-CITE-CITE-CITE-CITE-CITE

PPPM initialization ...
  using 12-bit tables for long-range coulomb (src/kspace.cpp:342)
  G vector (1/distance) = 0.27475351
  grid = 48 48 75
  stencil order = 5
  estimated absolute RMS force accuracy = 0.00017349588
  estimated relative force accuracy = 1.2048622e-05
  using double precision FFTW3
  3d grid and FFT values/proc = 248050 172800
Generated 0 of 1 mixed pair_coeff terms from arithmetic mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 7, bins = 7 7 12
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair buck/coul/long, perpetual
      attributes: half, newton on
      pair build: half/bin/atomonly/newton
      stencil: half/bin/3d
      bin: standard
Setting up Verlet run ...
  Unit style    : metal
  Current step  : 0
  Time step     : 0.0005
Per MPI rank memory allocation (min/avg/max) = 53.74 | 53.74 | 53.74 Mbytes
   Step          Time           Temp          Press          PotEng         KinEng         E_vdwl         E_coul         TotEng    
         0   0              37.86787       970490.51     -103184.95      56.383275      66282.587     -95410.923     -103128.57    
       100   0.05           15.345323      970347.51     -103149.09      22.848383      66291.972     -95384.928     -103126.24    
Loop time of 11.5352 on 1 procs for 100 steps with 11520 atoms

Performance: 0.375 ns/day, 64.084 hours/ns, 8.669 timesteps/s, 99.868 katom-step/s
99.5% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 9.0305     | 9.0305     | 9.0305     |   0.0 | 78.29
Kspace  | 2.4288     | 2.4288     | 2.4288     |   0.0 | 21.06
Neigh   | 0          | 0          | 0          |   0.0 |  0.00
Comm    | 0.018811   | 0.018811   | 0.018811   |   0.0 |  0.16
Output  | 0.00011623 | 0.00011623 | 0.00011623 |   0.0 |  0.00
Modify  | 0.047615   | 0.047615   | 0.047615   |   0.0 |  0.41
Other   |            | 0.009386   |            |       |  0.08

Nlocal:          11520 ave       11520 max       11520 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          30464 ave       30464 max       30464 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    4.98432e+06 ave 4.98432e+06 max 4.98432e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 4984320
Ave neighs/atom = 432.66667
Neighbor list builds = 0
Dangerous builds = 0


unfix fix_nvt
unfix fix_mom

print "=== Equilibration complete; handing off to TTM spike ===" append yes
=== Equilibration complete; handing off to TTM spike ===
include         inputs/lammps/in.ttm_spike.lmp
# --- TTM spike stage: NVE on interior + USER-TTM electrons ---
print "=== TTM spike stage: NVE (interior) + USER-TTM electron field ===" append yes
=== TTM spike stage: NVE (interior) + USER-TTM electron field ===

# Interior = all atoms minus the x/y rim sponge from rim_langevin.in
group interior subtract all rim
1455 atoms in group interior

# For logging only (not used by fix ttm/grid in this starter variant)
variable r0_A equal ${R0}*10.0
variable r0_A equal 4.5*10.0
print "TTM source (placeholder): r0 = ${R0} nm = ${r0_A} A ; Se = ${SE} eV/A ; g0 = ${G0} W/m^3/K" append yes
TTM source (placeholder): r0 = 4.5 nm = 45 A ; Se = 27 eV/A ; g0 = 7.4e+16 W/m^3/K

# Lattice integrator
fix f_nve interior nve

# --- USER-TTM (distributed grid) ---
# Starter grid ~1.0 A spacing; tune in Phase 2
variable NX equal ceil(lx/1.0)
variable NY equal ceil(ly/1.0)
variable NZ equal ceil(lz/1.0)

# Nominal electron parameters in metal units (placeholders to get the pipeline running)
#   CE0: eV/(electron*K),  RHOE0: electrons/A^3,
#   KE0: eV/(ps*A*K),      GP: mass/ps, GS: mass/ps, V0: A/ps
variable CE0    equal 1.0
variable RHOE0  equal 1.0
variable KE0    equal 1.0
variable GP     equal 1.0e-4
variable GS     equal 0.0
variable V0     equal 1.0

# One and only one ttm/grid fix; seed must be a positive integer
fix f_ttm interior ttm/grid 12345 ${CE0} ${RHOE0} ${KE0} ${GP} ${GS} ${V0} ${NX} ${NY} ${NZ} set 300.0
fix f_ttm interior ttm/grid 12345 1 ${RHOE0} ${KE0} ${GP} ${GS} ${V0} ${NX} ${NY} ${NZ} set 300.0
fix f_ttm interior ttm/grid 12345 1 1 ${KE0} ${GP} ${GS} ${V0} ${NX} ${NY} ${NZ} set 300.0
fix f_ttm interior ttm/grid 12345 1 1 1 ${GP} ${GS} ${V0} ${NX} ${NY} ${NZ} set 300.0
fix f_ttm interior ttm/grid 12345 1 1 1 0.0001 ${GS} ${V0} ${NX} ${NY} ${NZ} set 300.0
fix f_ttm interior ttm/grid 12345 1 1 1 0.0001 0 ${V0} ${NX} ${NY} ${NZ} set 300.0
fix f_ttm interior ttm/grid 12345 1 1 1 0.0001 0 1 ${NX} ${NY} ${NZ} set 300.0
fix f_ttm interior ttm/grid 12345 1 1 1 0.0001 0 1 44 ${NY} ${NZ} set 300.0
fix f_ttm interior ttm/grid 12345 1 1 1 0.0001 0 1 44 44 ${NZ} set 300.0
fix f_ttm interior ttm/grid 12345 1 1 1 0.0001 0 1 44 44 83 set 300.0

# Initialize computes/thermo after adding fixes
run 0 post no
PPPM initialization ...
  using 12-bit tables for long-range coulomb (src/kspace.cpp:342)
  G vector (1/distance) = 0.27475351
  grid = 48 48 75
  stencil order = 5
  estimated absolute RMS force accuracy = 0.00017349588
  estimated relative force accuracy = 1.2048622e-05
  using double precision FFTW3
  3d grid and FFT values/proc = 248050 172800
Generated 0 of 1 mixed pair_coeff terms from arithmetic mixing rule
Setting up Verlet run ...
  Unit style    : metal
  Current step  : 100
  Time step     : 0.0005
Per MPI rank memory allocation (min/avg/max) = 59.45 | 59.45 | 59.45 Mbytes
   Step          Time           Temp          Press          PotEng         KinEng         E_vdwl         E_coul         TotEng    
       100   0.05           15.345323      970347.51     -103149.09      22.848383      66291.972     -95384.928     -103126.24    
Loop time of 8.29e-07 on 1 procs for 0 steps with 11520 atoms


# Spike length: default NSTEPS minus equilibration steps (neq is always defined now)
variable nspike equal ${NSTEPS}-${neq}
variable nspike equal 400-${neq}
variable nspike equal 400-100
print "Spike steps (nspike) = ${nspike}" append yes
Spike steps (nspike) = 300

# Run the spike
run ${nspike}
run 300
PPPM initialization ...
  using 12-bit tables for long-range coulomb (src/kspace.cpp:342)
  G vector (1/distance) = 0.27475351
  grid = 48 48 75
  stencil order = 5
  estimated absolute RMS force accuracy = 0.00017349588
  estimated relative force accuracy = 1.2048622e-05
  using double precision FFTW3
  3d grid and FFT values/proc = 248050 172800
Generated 0 of 1 mixed pair_coeff terms from arithmetic mixing rule
Setting up Verlet run ...
  Unit style    : metal
  Current step  : 100
  Time step     : 0.0005
Per MPI rank memory allocation (min/avg/max) = 59.45 | 59.45 | 59.45 Mbytes
   Step          Time           Temp          Press          PotEng         KinEng         E_vdwl         E_coul         TotEng    
       100   0.05           15.345323      970347.51     -103149.09      22.848383      66291.972     -95384.928     -103126.24    
       200   0.1            24.107153      969162.84     -103162.1       35.894288      66210.807     -95317.058     -103126.21    
       300   0.15           34.299943      966769.94     -103177.21      51.070819      66055.85      -95177.456     -103126.14    
       400   0.2            55.242483      961048.4      -103208.33      82.253163      65688.211     -94841.843     -103126.08    
Loop time of 35.2256 on 1 procs for 300 steps with 11520 atoms

Performance: 0.368 ns/day, 65.233 hours/ns, 8.517 timesteps/s, 98.111 katom-step/s
99.6% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 27.239     | 27.239     | 27.239     |   0.0 | 77.33
Kspace  | 7.366      | 7.366      | 7.366      |   0.0 | 20.91
Neigh   | 0.089616   | 0.089616   | 0.089616   |   0.0 |  0.25
Comm    | 0.057208   | 0.057208   | 0.057208   |   0.0 |  0.16
Output  | 0.00035722 | 0.00035722 | 0.00035722 |   0.0 |  0.00
Modify  | 0.44136    | 0.44136    | 0.44136    |   0.0 |  1.25
Other   |            | 0.03161    |            |       |  0.09

Nlocal:          11520 ave       11520 max       11520 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          30459 ave       30459 max       30459 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    4.96562e+06 ave 4.96562e+06 max 4.96562e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 4965624
Ave neighs/atom = 431.04375
Neighbor list builds = 1
Dangerous builds = 0

# Cleanup
unfix f_nve
unfix f_ttm

print "=== Spike complete; end of Phase 0 nominal shot ===" append yes
=== Spike complete; end of Phase 0 nominal shot ===
Total wall time: 0:00:47
