# ------------------------------------------------------------
# rim_langevin.in — Define x–y rim region and apply Langevin damping
#
# Purpose: Create a thin "sponge" rim near the x and y box boundaries
#          and apply a Langevin thermostat to that rim only, to absorb
#          pressure waves/heat. The interior group is defined elsewhere
#          as `group interior subtract all rim`.
#
# Optional input variables (may be -var from launcher or set here):
#   RIM_WIDTH_NM  — rim thickness [nm]    (default: 1.5 nm)
#   RIM_GAMMA     — damping γ [ps^-1]     (default: 1.0 ps^-1)
#   RIM_TK        — target temperature K  (default: 300 K)
#
# Units: metal (Å, ps, eV, ...)
# ------------------------------------------------------------

variable rim_w_A    equal ${RIM_WIDTH_NM}*10.0

# Box bounds (Å)
variable bxlo equal xlo
variable bxhi equal xhi
variable bylo equal ylo
variable byhi equal yhi

# Convenience: precompute slabs
variable x_cut_hi equal v_bxhi - v_rim_w_A
variable x_cut_lo equal v_bxlo + v_rim_w_A
variable y_cut_hi equal v_byhi - v_rim_w_A
variable y_cut_lo equal v_bylo + v_rim_w_A

# Four slab regions near x/y boundaries; union them into one rim region
region rim_xlo block ${bxlo}     ${x_cut_lo}  INF INF  INF INF  units box
region rim_xhi block ${x_cut_hi} ${bxhi}           INF INF  INF INF  units box
region rim_ylo block INF INF  ${bylo}     ${y_cut_lo}  INF INF units box
region rim_yhi block INF INF  ${y_cut_hi} ${byhi}             INF INF units box

region rim union 4 rim_xlo rim_xhi rim_ylo rim_yhi

# Materialize the group (idempotent)
group rim region rim

# ---- Langevin thermostat on rim only ----
# Translate γ [ps^-1] to damp time [ps]:  damp = 1/γ (protect against γ<=0)
variable rim_damp_ps equal if(${RIM_GAMMA} > 0.0, 1.0/${RIM_GAMMA}, 1.0)

# Use a dedicated temperature compute for the rim group
compute c_rim_temp rim temp

# Seed policy: reuse VEL_SEED if defined; otherwise a fixed constant
variable RIM_SEED equal 24680

fix f_rim_langevin rim langevin ${RIM_TK} ${RIM_TK} ${rim_damp_ps} ${RIM_SEED}
fix_modify f_rim_langevin temp c_rim_temp

# Provenance echo
print "RIM: width=${RIM_WIDTH_NM} nm (${rim_w_A} Å), gamma=${RIM_GAMMA} ps^-1, T=${RIM_TK} K, damp=${rim_damp_ps} ps" append yes

